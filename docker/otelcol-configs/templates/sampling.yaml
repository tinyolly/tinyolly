# Sample traces at configurable rate to reduce volume

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

extensions:
  opamp:
    server:
      ws:
        endpoint: ws://tinyolly-opamp-server:4320/v1/opamp

processors:
  batch:
    timeout: 1s
    send_batch_size: 1024

  # Sample 10% of traces (adjust sampling_percentage as needed)
  probabilistic_sampler:
    sampling_percentage: 10
    hash_seed: 22

  # Alternative: Tail-based sampling for more intelligent decisions
  # tail_sampling:
  #   decision_wait: 10s
  #   num_traces: 100
  #   policies:
  #     - name: errors-policy
  #       type: status_code
  #       status_code: {status_codes: [ERROR]}
  #     - name: slow-traces-policy
  #       type: latency
  #       latency: {threshold_ms: 1000}
  #     - name: probabilistic-policy
  #       type: probabilistic
  #       probabilistic: {sampling_percentage: 10}

exporters:
  debug:
    verbosity: detailed

  otlp:
    endpoint: "tinyolly-otlp-receiver:4343"
    tls:
      insecure: true

service:
  extensions: [opamp]
  pipelines:
    traces:
      receivers: [otlp]
      processors: [probabilistic_sampler, batch]
      exporters: [debug, otlp]

    metrics:
      receivers: [otlp]
      processors: [batch]
      exporters: [debug, otlp]

    logs:
      receivers: [otlp]
      processors: [batch]
      exporters: [debug, otlp]
